<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Угадай бренд по слогану</title>
    <style>
    /* Ваши текущие стили */
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        height: 100vh;
        background-color: #f4f4f4;
        overflow: hidden;
    }

	/* Анимация для исчезновения */
	.fade-out {
		animation: fadeOut 0.7s ease forwards;
	}

	@keyframes fadeOut {
		from {
			opacity: 1;
		}
		to {
			opacity: 0;
		}
	}

	/* Анимация для появления */
	.fade-in {
		animation: fadeIn 0.7s ease forwards;
	}

	@keyframes fadeIn {
		from {
			opacity: 0;
		}
		to {
			opacity: 1;
		}
	}

	/* Анимация мигания для правильного ответа */
	@keyframes correctBlink {
		0% { border-color: green; }
		50% { border-color: transparent; }
		100% { border-color: green; }
	}

	.correct-border {
		animation: correctBlink 0.5s ease 4; /* Мигание 4 раза */
	}

	/* Анимация мигания для неправильного ответа */
	@keyframes wrongBlink {
		0% { border-color: red; }
		50% { border-color: transparent; }
		100% { border-color: red; }
	}

	.wrong-border {
		animation: wrongBlink 0.5s ease 4; /* Мигание 4 раза */
	}

    /* Остальные стили */
    .game-container {
        width: 100vw;
        height: 100vh;
        display: flex;
        flex-direction: column;
        background: white;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }

        .game-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        @media (orientation: portrait) {
            .game-container {
                width: 100vw;
                height: calc(100vw * 16 / 9);
                max-width: none;
                max-height: 100vh;
            }

            #question-section {
                height: 15%;
                font-size: clamp(16px, 4vw, 24px);
                padding: 10px;
            }

            #progress-bar {
                height: 3px;
            }

            #answer-section {
                height: calc(85% - 3px);
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                padding: 10px;
            }

            .answer {
                padding: 5px;
            }

            .answer img {
                width: 95%;
                height: 95%;
                object-fit: contain;
            }
        }

		@media (orientation: landscape) {
			.game-container {
				width: calc(100vh * 16 / 9); /* Сохраняем пропорции */
				height: 100vh; /* Занимаем всю высоту экрана */
				max-width: none;
				display: flex;
				flex-direction: column;
			}

			#question-section {
				flex: 0 0 10%; /* Фиксированная высота 10% */
				font-size: clamp(16px, 2.5vw, 24px);
				padding: 10px;
				display: flex;
				justify-content: center;
				align-items: center;
			}

			#progress-bar {
				flex: 0 0 3px; /* Фиксированная высота 3px */
				background-color: #ffa500;
				transform-origin: left;
				transform: scaleX(0);
				transition: transform 0.1s linear;
			}

			#answer-section {
				flex: 1; /* Занимает оставшееся пространство */
				display: grid;
				grid-template-columns: repeat(4, 1fr);
				gap: 10px;
				padding: 20px;
				overflow-y: auto; /* Добавляем прокрутку, если контент не помещается */
			}

			.answer {
				display: flex;
				align-items: center;
				justify-content: center;
				background-color: #f4f4f4;
				border: 2px solid #ddd;
				border-radius: 10px;
				cursor: pointer;
				transition: transform 0.3s, opacity 0.3s;
				text-align: center;
			}

			.answer img {
				width: 95%;
				height: 95%;
				object-fit: contain;
			}
		}

        #question-section {
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            background-color: #007bff;
            color: white;
        }

        #progress-bar {
            width: 100%;
            background-color: #ffa500;
            transform-origin: left;
            transform: scaleX(0);
            transition: transform 0.1s linear;
        }

        #answer-section {
            display: grid;
            gap: 10px;
            padding: 20px;
        }

        .answer {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f4f4f4;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.3s, opacity 0.3s;
            text-align: center;
        }

        .answer.correct {
            border-color: green;
        }

        .answer.wrong {
            border-color: red;
        }

        .answer.hide {
            opacity: 0;
            transform: scale(0);
        }

        .answer.disabled {
            pointer-events: none;
        }

		.modal {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0, 0, 0, 0.7); /* Темный полупрозрачный фон */
			justify-content: center;
			align-items: center;
			z-index: 1000;
		}

		.modal-content {
			background: white; /* Белый фон для средней зоны */
			border-radius: 20px;
			overflow: hidden; /* Чтобы углы были скруглены */
			max-width: 400px;
			width: 90%;
			box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); /* Тень для контраста */
			animation: slideIn 0.5s ease-out;
		}

		@keyframes slideIn {
			from {
				transform: translateY(-50px);
				opacity: 0;
			}
			to {
				transform: translateY(0);
				opacity: 1;
			}
		}

		/* Верхняя зона */
		.modal-header {
			background: #007bff; /* Синий фон, как у зоны вопросов в игре */
			padding: 20px;
			text-align: center;
		}

		.modal-header h2 {
			margin: 0;
			font-size: 30px;
			color: white; /* Белый текст */
			text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2); /* Легкая тень */
		}

		/* Средняя зона */
		.modal-body {
			padding: 8px;
			text-align: center;
		}

		.modal-body p {
			font-size: 18px;
			color: #333; /* Черный текст */
			margin: 10px 0;
		}

		/* Нижняя зона */
		.modal-footer {
		/* 	background: #0056b3; /* Темно-синий фон для кнопок */
			padding: 8px;
			text-align: center;
		}

		.modal-footer button {
			margin: 5px;
			padding: 12px 24px;
			background: #007bff; /* Синий цвет кнопок */
			color: white; /* Белый текст */
			border: none;
			border-radius: 25px;
			cursor: pointer;
			font-size: 16px;
			font-weight: bold;
			text-transform: uppercase;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2); /* Тень */
			transition: all 0.3s ease;
		}

		.modal-footer button:hover {
			background: #004080; /* Темно-синий при наведении */
			transform: translateY(-2px);
			box-shadow: 0 6px 8px rgba(0, 0, 0, 0.3); /* Увеличенная тень */
		}

		.modal-footer button:disabled {
			background: #ccc; /* Серый для неактивных кнопок */
			cursor: not-allowed;
			transform: none;
			box-shadow: none;
		}

		.modal-footer button:active {
			transform: translateY(0);
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2); /* Тень при нажатии */
		}
		
        /* Новые стили для начального экрана */
        #start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        #start-btn {
            padding: 15px 30px;
            font-size: 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #start-btn:hover {
            background-color: #0056b3;
        }

        .hidden {
            display: none !important; /* Добавлено !important */
        }
    </style>
</head>
<body>
    <!-- Начальный экран -->
    <div id="start-screen">
        <button id="start-btn">Начать игру</button>
    </div>

    <!-- Игровой контейнер -->
    <div class="game-container hidden">
        <div id="question-section">
            <h1 id="question"></h1>
        </div>
        <div id="progress-bar"></div>
        <div id="answer-section"></div>
    </div>

	<div id="modal" class="modal">
		<div class="modal-content">
			<!-- Верхняя зона -->
			<div class="modal-header">
				<h2>Статистика игры</h2>
			</div>

			<!-- Средняя зона -->
			<div class="modal-body">
				<p id="modal-score">Правильных ответов: <span class="highlight">0</span> из <span class="highlight">25</span></p>
				<p id="modal-high-score">🏆 Лучший результат: <span class="highlight">0</span></p>
				<p id="game-count-message">🎮 Сыграно игр: <span class="highlight">0</span> из 3000</p>
			</div>

			<!-- Нижняя зона -->
			<div class="modal-footer">
				<button id="modal-close-btn">Закрыть</button>
				<button id="modal-restart-btn">Играть снова</button>
			</div>
		</div>
	</div>

    <audio id="correct-sound" src="sounds/correct.mp3"></audio>
    <audio id="wrong-sound" src="sounds/wrong.mp3"></audio>
    <audio id="click-sound" src="sounds/click.mp3"></audio>

    <script>
	
		// Предзагрузка звуков
		function preloadSounds() {
			const soundUrls = [
				'sounds/correct.mp3',
				'sounds/wrong.mp3',
				'sounds/click.mp3',
				'sounds/correct/correct1.mp3',
				'sounds/correct/correct2.mp3',
				'sounds/correct/correct3.mp3',
				'sounds/correct/correct4.mp3',
				'sounds/correct/correct5.mp3',
				'sounds/correct/correct6.mp3',
				'sounds/correct/correct7.mp3',
				'sounds/correct/correct8.mp3',
				'sounds/wrong/wrong1.mp3',
				'sounds/wrong/wrong2.mp3',
				'sounds/wrong/wrong3.mp3',
				'sounds/wrong/wrong4.mp3',
				'sounds/wrong/wrong5.mp3',
				'sounds/wrong/wrong6.mp3',
				'sounds/wrong/wrong7.mp3',
				'sounds/wrong/wrong8.mp3',
				'sounds/wrong/wrong9.mp3',
				'sounds/wrong/wrong10.mp3',
				'sounds/wrong/wrong11.mp3',
				'sounds/wrong/wrong12.mp3',
				'sounds/wrong/wrong13.mp3',
				'sounds/wrong/wrong14.mp3',
				'sounds/wrong/wrong15.mp3',
				'sounds/start/start1.mp3',
				'sounds/start/start2.mp3',
				'sounds/start/start3.mp3',
				'sounds/start/start4.mp3',
				'sounds/start/start5.mp3',
				'sounds/end/end1.mp3',
				'sounds/end/end2.mp3',
				'sounds/end/end3.mp3',
				'sounds/end/end4.mp3',
				'sounds/end/end5.mp3',
				'sounds/end/end6.mp3'
			];

			soundUrls.forEach(url => {
				const audio = new Audio(url);
				audio.preload = 'auto';
			});
		}

		// Вызов функции предзагрузки при загрузке страницы
		window.addEventListener('load', preloadSounds);	
			
        // Переменная для отслеживания разблокировки звука
        let isSoundUnlocked = false;
		
		// Флаг для отслеживания воспроизведения звука
		let isSoundPlaying = false;

		// Массив для хранения активных звуков				
		let activeSounds = [];
		
		function waitForSounds(callback) {
			const checkSounds = () => {
				if (activeSounds.length === 0) {
					callback(); // Вызываем callback, когда звуков нет
				} else {
					setTimeout(checkSounds, 100); // Проверяем каждые 100 мс
				}
			};
			checkSounds();
		}		

        // Функция для воспроизведения звука
		function playSound(type) {
			if (!isSoundUnlocked) {
				console.log("Звук заблокирован: пользователь не начал игру.");
				return;
			}

			// Воспроизведение базового звука (кроме типа 'end')
			let baseSound;
			if (type !== 'end') { // Исключаем базовый звук для типа 'end'
				switch (type) {
					case 'correct':
						baseSound = document.getElementById('correct-sound');
						break;
					case 'wrong':
						baseSound = document.getElementById('wrong-sound');
						break;
					case 'click':
						baseSound = document.getElementById('click-sound');
						break;
					case 'swipe':
						baseSound = document.getElementById('swipe-sound');
						break;
					default:
						baseSound = null;
				}
			}

			if (baseSound) {
				console.log(`Воспроизведение базового звука: ${type}`);
				baseSound.currentTime = 0;
				activeSounds.push(baseSound); // Добавляем звук в массив активных
				baseSound.play().catch(error => console.error("Ошибка воспроизведения базового звука:", error));

				// Удаляем звук из массива после завершения
				baseSound.addEventListener('ended', () => {
					activeSounds = activeSounds.filter(sound => sound !== baseSound);
					console.log(`Базовый звук ${type} завершен.`);
				});
			}

			// Воспроизведение случайного звука из папки
			let soundFolder;
			let soundFiles = [];

			switch (type) {
				case 'correct':
					soundFolder = 'sounds/correct/';
					soundFiles = ['correct1.mp3', 'correct2.mp3', 'correct3.mp3', 'correct4.mp3', 'correct5.mp3', 'correct6.mp3', 'correct7.mp3', 'correct8.mp3'];
					break;
				case 'wrong':
					soundFolder = 'sounds/wrong/';
					soundFiles = ['wrong1.mp3', 'wrong2.mp3', 'wrong3.mp3', 'wrong4.mp3', 'wrong5.mp3', 'wrong6.mp3', 'wrong7.mp3', 'wrong8.mp3', 'wrong9.mp3', 'wrong10.mp3', 'wrong11.mp3', 'wrong12.mp3', 'wrong13.mp3', 'wrong14.mp3', 'wrong15.mp3'];
					break;
				case 'start':
					soundFolder = 'sounds/start/';
					soundFiles = ['start1.mp3', 'start2.mp3', 'start3.mp3', 'start4.mp3', 'start5.mp3'];
					break;
				case 'end':
					soundFolder = 'sounds/end/';
					soundFiles = ['end1.mp3', 'end2.mp3', 'end3.mp3', 'end4.mp3', 'end5.mp3', 'end6.mp3'];
					break;
				default:
					return; // Для типа 'click' и 'swipe' не воспроизводим случайный звук
			}

			if (soundFolder && soundFiles.length > 0) {
				const randomSoundFile = soundFiles[Math.floor(Math.random() * soundFiles.length)];
				const randomSound = new Audio(soundFolder + randomSoundFile);

				// Задержка перед воспроизведением случайного звука
				setTimeout(() => {
					console.log(`Воспроизведение случайного звука: ${type}`);
					randomSound.currentTime = 0;
					activeSounds.push(randomSound); // Добавляем звук в массив активных
					randomSound.play().catch(error => console.error("Ошибка воспроизведения случайного звука:", error));

					// Удаляем звук из массива после завершения
					randomSound.addEventListener('ended', () => {
						activeSounds = activeSounds.filter(sound => sound !== randomSound);
						console.log(`Случайный звук ${type} завершен.`);
					});
				}, baseSound ? baseSound.duration * 1000 : 0); // Ждем завершения базового звука
			}
		}

        // Обработчик нажатия кнопки "Начать игру"
        const startScreen = document.getElementById('start-screen');
        const startBtn = document.getElementById('start-btn');
        const gameContainer = document.querySelector('.game-container');

		startBtn.addEventListener('click', () => {
			console.log("Кнопка 'Начать игру' нажата."); // Отладочное сообщение

			isSoundUnlocked = true; // Разблокируем звук
			playSound('click'); // Воспроизводим короткий звук клика
			playSound('start'); // Воспроизводим звук начала игры

			// Скрываем начальный экран
			startScreen.classList.add('hidden');
			console.log("Начальный экран скрыт."); // Отладочное сообщение

			// Показываем игровой контейнер
			gameContainer.classList.remove('hidden');
			console.log("Игровой контейнер показан."); // Отладочное сообщение

			startGame(); // Запускаем игру
		});
		
        // Остальной JavaScript код
        const questionElement = document.getElementById('question');
        const answerSection = document.getElementById('answer-section');

        const modal = document.getElementById('modal');
        const modalScore = document.getElementById('modal-score');
        const modalHighScore = document.getElementById('modal-high-score');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const modalRestartBtn = document.getElementById('modal-restart-btn');
        const gameCountMessage = document.getElementById('game-count-message');

        const allQuestions = [
            {
                question: "Найдётся всё",
                answers: [
                    { text: "Яндекс", correct: true, image: "images/yandex.jpg" },
                    { text: "Google", correct: false, image: "images/google.jpg" },
                    { text: "Mail.ru", correct: false, image: "images/mailru.jpg" },
                    { text: "Rambler", correct: false, image: "images/rambler.jpg" }
                ]
            },
            {
                question: "Just Do It",
                answers: [
                    { text: "Nike", correct: true, image: "images/nike.jpg" },
                    { text: "Adidas", correct: false, image: "images/adidas.jpg" },
                    { text: "Puma", correct: false, image: "images/puma.jpg" },
                    { text: "Reebok", correct: false, image: "images/reebok.jpg" }
                ]
            },
            {
                question: "Всемирная история",
                answers: [
                    { text: "Банк Империал", correct: true, image: "images/imperial.jpg" },
                    { text: "Сбербанк", correct: false, image: "images/sberbank.jpg" },
                    { text: "Альфа-Банк", correct: false, image: "images/alfabank.jpg" },
                    { text: "ВТБ", correct: false, image: "images/vtb.jpg" }
                ]
            }			
			
            // Добавьте больше вопросов здесь
        ];

        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let timer;
        const timeLimit = 10;
        const maxGameCount = 30000;

        let gameCount = localStorage.getItem('gameCount') ? parseInt(localStorage.getItem('gameCount')) : 0;

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function startGame() {
            if (gameCount >= maxGameCount) {
                alert("Вы достигли лимита игр (3 раза).");
                return;
            }

            currentQuestions = getRandomQuestions(25);
            currentQuestionIndex = 0;
            score = 0;
            showQuestion();
        }

        function getRandomQuestions(count) {
            const shuffledQuestions = shuffleArray([...allQuestions]);
            return shuffledQuestions.slice(0, count);
        }

		function showQuestion() {
			if (currentQuestionIndex >= currentQuestions.length) {
				endGame();
				return;
			}

			// Анимация исчезновения текущего вопроса
			questionElement.classList.add('fade-out');
			answerSection.classList.add('fade-out');

			// Ждем завершения анимации перед обновлением содержимого
			setTimeout(() => {
				resetTimer();
				startTimer();

				const question = currentQuestions[currentQuestionIndex];
				questionElement.innerText = question.question;
				answerSection.innerHTML = '';

				const shuffledAnswers = shuffleArray([...question.answers]);
				shuffledAnswers.forEach(answer => {
					const button = document.createElement('div');
					button.classList.add('answer');
					button.innerHTML = `<img src="${answer.image}" alt="${answer.text}">`;

					button.addEventListener('click', () => removeAnswer(button, answer));

					if ('ontouchstart' in window) {
						addSwipeListener(button, answer);
					}

					answerSection.appendChild(button);
				});

				// Анимация появления нового вопроса
				questionElement.classList.remove('fade-out');
				answerSection.classList.remove('fade-out');
				questionElement.classList.add('fade-in');
				answerSection.classList.add('fade-in');

				// Убираем классы анимации после завершения
				setTimeout(() => {
					questionElement.classList.remove('fade-in');
					answerSection.classList.remove('fade-in');
				}, 700); // Длительность анимации
				// Запуск таймера после завершения анимации появления
				setTimeout(() => {
					resetTimer();
					startTimer();
				}, 700); // Задержка перед запуском таймера				
			}, 700); // Задержка перед обновлением
		}

        function addSwipeListener(button, answer) {
            let startX = 0;
            let startY = 0;
            let isSwiped = false;

            button.addEventListener('touchstart', (e) => {
                const touch = e.touches[0];
                startX = touch.clientX;
                startY = touch.clientY;
                isSwiped = false;
            });

            button.addEventListener('touchmove', (e) => {
                if (isSwiped) return;

                const touch = e.touches[0];
                const deltaX = touch.clientX - startX;
                const deltaY = touch.clientY - startY;

                if (Math.abs(deltaX) > 50 || Math.abs(deltaY) > 50) {
                    isSwiped = true;

                    const direction = Math.abs(deltaX) > Math.abs(deltaY) ? (deltaX > 0 ? 'right' : 'left') : (deltaY > 0 ? 'down' : 'up');

                    button.style.transition = 'transform 0.3s, opacity 0.3s';
                    if (direction === 'left' || direction === 'right') {
                        button.style.transform = `translateX(${deltaX > 0 ? 100 : -100}%)`;
                    } else {
                        button.style.transform = `translateY(${deltaY > 0 ? 100 : -100}%)`;
                    }
                    button.style.opacity = '0';

                    setTimeout(() => {
                        removeAnswer(button, answer);
                    }, 300);
                }
            });

            button.addEventListener('touchend', (e) => {
                if (!isSwiped) {
                    const deltaX = e.changedTouches[0].clientX - startX;
                    const deltaY = e.changedTouches[0].clientY - startY;

                    const speedX = Math.abs(deltaX) / (e.timeStamp - startTime);
                    if (speedX < 0.5) {
                        button.style.transition = 'transform 0.2s, opacity 0.2s';
                        button.style.transform = 'translateX(0) translateY(0)';
                        button.style.opacity = '1';
                    } else {
                        isSwiped = true;
                        button.style.transition = 'transform 0.3s, opacity 0.3s';
                        button.style.transform = `translateX(${deltaX > 0 ? 100 : -100}%)`;
                        button.style.opacity = '0';
                        setTimeout(() => {
                            removeAnswer(button, answer);
                        }, 300);
                    }
                }
            });
        }

        function removeAnswer(button, answer) {
            playSound('click');
            button.classList.add('hide');
            checkRemainingAnswers();
        }

        //function checkRemainingAnswers() {
          //const remainingAnswers = document.querySelectorAll('.answer:not(.hide)');
          //if (remainingAnswers.length === 1) {
                //const selectedAnswer = remainingAnswers[0];
                //selectedAnswer.classList.add('disabled');

                //const isCorrect = selectedAnswer.querySelector('img').alt === currentQuestions[currentQuestionIndex].answers.find(a => a.correct).text;

                //if (isCorrect) {
                    //score++;
                    //selectedAnswer.classList.add('correct');
                    //playSound('correct');
                //} else {
                    //selectedAnswer.classList.add('wrong');
                    //playSound('wrong');
                //}

                //if (currentQuestionIndex === currentQuestions.length - 1) {
                    //clearInterval(timer);
                //}

                //setTimeout(() => {
                    //currentQuestionIndex++;
                    //showQuestion();
                //}, 1000);
            //}
        //}

		function handleTimeOut() {
			playSound('wrong'); // Воспроизведение звука при истечении времени

			const remainingAnswers = document.querySelectorAll('.answer:not(.hide)');
			remainingAnswers.forEach(answer => {
				answer.classList.add('wrong');
				answer.classList.add('wrong-border'); // Анимация мигания
				answer.classList.add('disabled');
			});

			// Убираем анимацию через 2 секунды
			setTimeout(() => {
				remainingAnswers.forEach(answer => {
					answer.classList.remove('wrong-border');
				});
			}, 2000);

			if (currentQuestionIndex === currentQuestions.length - 1) {
				clearInterval(timer);
			}

			// Ждем завершения звука перед переходом к следующему вопросу
			waitForSounds(() => {
				currentQuestionIndex++;
				showQuestion();
			});
		}

		function checkRemainingAnswers() {
			const remainingAnswers = document.querySelectorAll('.answer:not(.hide)');
			if (remainingAnswers.length === 1) {
				const selectedAnswer = remainingAnswers[0];
				selectedAnswer.classList.add('disabled');

				const isCorrect = selectedAnswer.querySelector('img').alt === currentQuestions[currentQuestionIndex].answers.find(a => a.correct).text;

				if (isCorrect) {
					score++;
					selectedAnswer.classList.add('correct');
					selectedAnswer.classList.add('correct-border'); // Анимация для правильного ответа
					playSound('correct');
				} else {
					selectedAnswer.classList.add('wrong');
					selectedAnswer.classList.add('wrong-border'); // Анимация для неправильного ответа
					playSound('wrong');
				}

				// Останавливаем таймер сразу после выбора последнего ответа
				clearInterval(timer); // Добавлено: остановка таймера
				resetTimer(); // Сбрасываем прогресс-бар

				if (currentQuestionIndex === currentQuestions.length - 1) {
					// Если это последний вопрос, завершаем игру
					endGame();
				} else {
					// Удаляем классы анимации через 2 секунды
					setTimeout(() => {
						selectedAnswer.classList.remove('correct-border', 'wrong-border');
					}, 2000);

					// Ждем завершения звука перед переходом к следующему вопросу
					waitForSounds(() => {
						currentQuestionIndex++;
						showQuestion();
					});
				}
			}
		}

		function endGame() {
			gameCount++;
			localStorage.setItem('gameCount', gameCount);
			saveScore(score);

			// Ждем завершения всех звуков (включая звук последнего ответа)
			waitForSounds(() => {
				// Задержка перед воспроизведением звука завершения игры
				setTimeout(() => {
					playSound('end'); // Воспроизводим звук завершения игры
				}, 1000); // Задержка 1 секунда

				// Ждем завершения звука завершения игры перед показом модального окна
				waitForSounds(() => {
					showModal();
				});
			});
		}

        function saveScore(score) {
            const highScore = localStorage.getItem('brandGameHighScore') || 0;
            if (score > highScore) {
                localStorage.setItem('brandGameHighScore', score);
            }
        }

		function showModal() {
			const modal = document.getElementById('modal');
			const modalContent = document.querySelector('.modal-content');
			const highScore = localStorage.getItem('brandGameHighScore') || 0;

			modalScore.innerText = `Правильных ответов: ${score} из ${currentQuestions.length}`;
			modalHighScore.innerText = `Лучший результат: ${highScore}`;
			gameCountMessage.innerText = `Сыграно игр: ${gameCount} из ${maxGameCount}`;

			if (gameCount >= maxGameCount) {
				modalRestartBtn.disabled = true;
				modalRestartBtn.innerText = "Лимит игр исчерпан";
			}

			// Показываем модальное окно
			modal.style.display = 'flex';

			// Ожидаем завершения анимации
			//modalContent.addEventListener('animationend', () => {
				//playSound('end'); // Воспроизводим звук модального окна
			//}, { once: true }); // Обработчик сработает только один раз
		}

        function resetGameCounter() {
            gameCount = 0;
            localStorage.setItem('gameCount', gameCount);
            modalRestartBtn.disabled = false;
            modalRestartBtn.innerText = "Играть снова";
            gameCountMessage.innerText = `Сыграно игр: ${gameCount} из ${maxGameCount}`;
            alert("Счетчик игр сброшен. Вы можете снова играть.");
        }

        function startTimer() {
            let timeLeft = timeLimit;
            const progressBar = document.getElementById('progress-bar');

            progressBar.style.transform = 'scaleX(1)';

            timer = setInterval(() => {
                timeLeft--;

                const progress = timeLeft / timeLimit;
                progressBar.style.transform = `scaleX(${progress})`;

                if (timeLeft <= 0) {
                    clearInterval(timer);
                    handleTimeOut();
                }
            }, 1000);
        }

		function closeModal() {
			const modal = document.getElementById('modal');
			modal.style.display = 'none';
		}

        function resetTimer() {
            clearInterval(timer);
            const progressBar = document.getElementById('progress-bar');
            progressBar.style.transform = 'scaleX(0)';
        }

		function stopAndClearAllSounds() {
			activeSounds.forEach(sound => {
				sound.pause(); // Останавливаем воспроизведение
				sound.currentTime = 0; // Сбрасываем время звука
			});
			activeSounds = []; // Очищаем массив активных звуков
		}

		// Добавление обработчиков для кнопок в модальном окне
		modalCloseBtn.addEventListener('click', () => {
			stopAndClearAllSounds(); // Останавливаем звуки перед закрытием
			closeModal();
		});

		modalRestartBtn.addEventListener('click', () => {
			stopAndClearAllSounds(); // Останавливаем звуки перед перезапуском
			closeModal();
			startGame();
		});

    </script>
</body>
</html>